<div class="page-container" style="padding: 24px">
  <!-- Header com título -->
  <div
    style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center"
  >
    <div style="display: flex; align-items: center; gap: 12px">
      <mat-icon style="color: #556b2f; font-size: 32px; width: 32px; height: 32px"
        >restaurant_menu</mat-icon
      >
      <h1 style="margin: 0; color: #556b2f; font-weight: 500; font-size: 28px">
        Gerenciamento de Comandas
      </h1>
    </div>
  </div>

  <mat-tab-group class="tabs-container">
    <!-- Tab Comandas Abertas -->
    <mat-tab>
      <ng-template mat-tab-label>
        Abertas ({{ (comandasAbertas$ | async)?.length || 0 }})
      </ng-template>

      <div class="tab-content">
        <div class="stats-row">
          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-number">{{ (totalAbertas$ | async) || 0 }}</div>
              <div class="stat-label">Total Abertas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-number">
                {{ formatarPreco((totalReceitaAbertas$ | async) || 0) }}
              </div>
              <div class="stat-label">Receita Pendente</div>
            </mat-card-content>
          </mat-card>
        </div>

        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="(comandasAbertas$ | async) || []" class="comandas-table">
              <!-- Coluna Nome -->
              <ng-container matColumnDef="nome">
                <th mat-header-cell *matHeaderCellDef>Nome do Cliente</th>
                <td mat-cell *matCellDef="let comanda">{{ comanda.nomeCliente }}</td>
              </ng-container>

              <!-- Coluna Data de Abertura -->
              <ng-container matColumnDef="dataCriacao">
                <th mat-header-cell *matHeaderCellDef>Data de Abertura</th>
                <td mat-cell *matCellDef="let comanda">{{ formatarData(comanda.dataCriacao) }}</td>
              </ng-container>

              <!-- Coluna Status -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let comanda">
                  <mat-chip color="primary">{{ comanda.status }}</mat-chip>
                </td>
              </ng-container>

              <!-- Coluna Total -->
              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let comanda" class="total-cell">
                  {{ formatarPreco(comanda.total) }}
                </td>
              </ng-container>

              <!-- Coluna Ações -->
              <ng-container matColumnDef="acoes">
                <th mat-header-cell *matHeaderCellDef>Ações</th>
                <td mat-cell *matCellDef="let comanda">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="visualizarComanda(comanda.id); $event.stopPropagation()"
                    matTooltip="Visualizar detalhes"
                    class="action-btn"
                  >
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="accent"
                    (click)="encerrarComanda(comanda); $event.stopPropagation()"
                    matTooltip="Encerrar comanda"
                    class="action-btn"
                  >
                    <mat-icon>check</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                class="comanda-row"
                (click)="visualizarComanda(row.id)"
              ></tr>
            </table>

            <div *ngIf="!(comandasAbertas$ | async)?.length" class="empty-state">
              <mat-icon>restaurant_menu</mat-icon>
              <h3>Nenhuma comanda aberta</h3>
              <p>Todas as comandas estão encerradas ou ainda não foram iniciadas.</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Tab Comandas Encerradas -->
    <mat-tab>
      <ng-template mat-tab-label>
        Encerradas ({{ (comandasEncerradas$ | async)?.length || 0 }})
      </ng-template>

      <div class="tab-content">
        <div class="stats-row">
          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-number">{{ (totalEncerradas$ | async) || 0 }}</div>
              <div class="stat-label">Total Encerradas</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card">
            <mat-card-content>
              <div class="stat-number">
                {{ formatarPreco((totalReceitaEncerradas$ | async) || 0) }}
              </div>
              <div class="stat-label">Receita Total</div>
            </mat-card-content>
          </mat-card>
        </div>

        <mat-card class="table-card">
          <mat-card-content>
            <table
              mat-table
              [dataSource]="(comandasEncerradas$ | async) || []"
              class="comandas-table"
            >
              <!-- Coluna Nome -->
              <ng-container matColumnDef="nome">
                <th mat-header-cell *matHeaderCellDef>Nome do Cliente</th>
                <td mat-cell *matCellDef="let comanda">{{ comanda.nomeCliente }}</td>
              </ng-container>

              <!-- Coluna Data de Abertura -->
              <ng-container matColumnDef="dataCriacao">
                <th mat-header-cell *matHeaderCellDef>Data de Abertura</th>
                <td mat-cell *matCellDef="let comanda">{{ formatarData(comanda.dataCriacao) }}</td>
              </ng-container>

              <!-- Coluna Data de Encerramento -->
              <ng-container matColumnDef="dataEncerramento">
                <th mat-header-cell *matHeaderCellDef>Data de Encerramento</th>
                <td mat-cell *matCellDef="let comanda">{{ formatarData(comanda.dataEncerramento) }}</td>
              </ng-container>

              <!-- Coluna Status -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let comanda">
                  <mat-chip color="accent">{{ comanda.status }}</mat-chip>
                </td>
              </ng-container>

              <!-- Coluna Total -->
              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let comanda" class="total-cell completed">
                  {{ formatarPreco(comanda.total) }}
                </td>
              </ng-container>

              <!-- Coluna Ações -->
              <ng-container matColumnDef="acoes">
                <th mat-header-cell *matHeaderCellDef>Ações</th>
                <td mat-cell *matCellDef="let comanda">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="visualizarComanda(comanda.id); $event.stopPropagation()"
                    matTooltip="Visualizar detalhes"
                    class="action-btn"
                  >
                    <mat-icon>visibility</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsEncerradas"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumnsEncerradas"
                class="comanda-row"
                (click)="visualizarComanda(row.id)"
              ></tr>
            </table>

            <div *ngIf="!(comandasEncerradas$ | async)?.length" class="empty-state">
              <mat-icon>check_circle</mat-icon>
              <h3>Nenhuma comanda encerrada</h3>
              <p>Ainda não há comandas finalizadas no sistema.</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
