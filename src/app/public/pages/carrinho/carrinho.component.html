<app-header
  [currentRoute]="'carrinho'"
  [totalItens]="getTotalItens()"
  [showSearchField]="false"
  (navClick)="onNavClick($event)"
>
</app-header>

<div class="carrinho-container">
  @if (itensComanda$ | async; as itens) {
    @if (itens.length === 0) {
      <div class="empty-cart">
        <mat-icon class="empty-icon">shopping_cart</mat-icon>
        <h3>Sua comanda está vazia</h3>
        <p>Adicione itens do cardápio para continuar</p>
        <button mat-raised-button color="primary" (click)="voltarCardapio()">
          <mat-icon>restaurant_menu</mat-icon>
          Ver Cardápio
        </button>
      </div>
    } @else {
      <mat-card class="itens-card">
        <mat-card-header>
          <mat-card-title>Itens da Comanda</mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <mat-list>
            @for (item of itens; track item.id) {
              <mat-list-item class="item-line">
                <div class="item-content">
                  <div class="item-header">
                    <span class="item-nome">{{ item.nome }}</span>
                    <span class="item-preco-unitario">{{ formatarPreco(item.valorUnitario) }}</span>
                  </div>

                  <div class="item-footer">
                    <div class="quantity-controls">
                      <button
                        mat-icon-button
                        (click)="diminuirQuantidade(item)"
                        class="quantity-btn decrease"
                      >
                        <mat-icon>remove</mat-icon>
                      </button>

                      <span class="quantity-display">{{ item.quantidade }}</span>

                      <button
                        mat-icon-button
                        (click)="aumentarQuantidade(item)"
                        class="quantity-btn increase"
                      >
                        <mat-icon>add</mat-icon>
                      </button>
                    </div>

                    <span class="item-total">{{ formatarPreco(calcularSubtotal(item)) }}</span>
                  </div>
                </div>
              </mat-list-item>
              <mat-divider></mat-divider>
            }
          </mat-list>
        </mat-card-content>
      </mat-card>

      @if (comandaAtual$ | async; as comanda) {
        <mat-card class="total-card">
          <mat-card-content>
            <div class="total-row">
              <span class="total-label">Total da Comanda:</span>
              <span class="total-value">{{ formatarPreco(comanda.valorTotal) }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <div class="actions">
        <button mat-stroked-button class="action-button" (click)="voltarCardapio()">
          <mat-icon>add</mat-icon>
          Adicionar Mais Itens
        </button>

        <button mat-raised-button style="background-color: #4caf50; color: white;" class="action-button" (click)="encerrarComanda()">
          <mat-icon>check</mat-icon>
          Finalizar Comanda
        </button>
      </div>
    }
  }
</div>
